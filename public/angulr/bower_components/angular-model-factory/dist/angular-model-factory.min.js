/**
 * modelFactory makes working with RESTful APIs in AngularJS easy
 * @version v0.4.8 - 2015-09-23
 * @link http://swimlane.github.io/angular-model-factory/
 * @author Austin McDaniel <amcdaniel2@gmail.com>, Juri Strumpflohner <juri.strumpflohner@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";!function(a,b){"function"==typeof define&&define.amd?define(["angular","uri-templates"],b):"undefined"!=typeof module&&module.exports?module.exports=b():a.ModelFactory=b(angular,UriTemplate)}(this,function(a,b){var c=a.module("modelFactory",[]),d=a.forEach,e=a.extend,f=a.copy,g=["$$array","$save","$destroy","$pending","$rollback","$diff","$update","$commit","$copy"],h=["actions","instance","list","defaults","pk","stripTrailingSlashes","map"],i=function(b){return d(arguments,function(c){c!==b&&d(c,function(c,d){-1===g.indexOf(d)&&(b[d]?a.isArray(b[d])?b[d].concat(c.filter(function(a){var c=-1!==b[d].indexOf(a);return c&&i(c,a),c})):a.isObject(b[d])?i(b[d],c):b[d]=c:a.isFunction(b[d])||(b[d]=c))})}),b},j=function(b,c){c=c||{},d(c,function(a,d){b.hasOwnProperty(d)||"$"===d.charAt(0)||delete c[d]});for(var e in b)b.hasOwnProperty(e)&&"$"!==e.charAt(0)&&(a.isObject(b[e])&&!a.isArray(b[e])?c[e]=j(b[e],c[e]):c[e]=b[e]);return c};return c.provider("$modelFactory",function(){var c=this;c.defaultOptions={prefix:"",pk:"id",stripTrailingSlashes:!0,defaults:{},map:{},actions:{base:{wrap:!0,beforeRequest:void 0,afterRequest:void 0,cache:!1},get:{method:"GET"},query:{method:"GET",isArray:!0},post:{method:"POST",invalidateCache:!0},update:{method:"PUT",invalidateCache:!0},"delete":{method:"DELETE",invalidateCache:!0}},instance:{},list:{}},c.$get=["$rootScope","$http","$q","$log","$cacheFactory",function(k,l,m,n,o){function p(n,p){function q(a){a=a||[],a.forEach(function(b,c){null!==b&&void 0!==b&&(a[c]=v(b,a))});var b=a.push;return a.push=function(){for(var c=Array.prototype.slice.call(arguments),d=0;d<c.length;d++)c[d]=v(c[d],a);b.apply(a,c)},p.list&&e(a,p.list),a}function r(b){var c=this,g=[];b=b||{},d(p.defaults,function(a,c){void 0===b[c]&&("function"==typeof a?b[c]=f(a(b)):b[c]=f(a))}),d(p.map,function(a,c){w(a)===w(r)||w(a)===w(q)?b[c]=new a(b[c]):"function"==typeof a?b[c]=a(b[c],b):(b[c]=b[a],delete b[a])}),d(p.actions,function(a,b){"$"===b[0]&&(c[b]=function(){return r.$buildRequest(b,a,c)})}),e(c,b),e(c,f(p.instance)),c.$save=function(){var b=c[p.pk]?"update":"post",d=r[b](this);return c.$pending=!0,d.then(function(d){c.$pending=!1,d&&c.$update(d);var e="post"===b?"created":"updated";k.$broadcast(u+"-"+e,c),g.push(a.toJson(c))},function(){c.$pending=!1}),d},c.$destroy=function(){var a=r["delete"](this);return c.$pending=!0,a.then(function(){c.$pending=!1;var a=c.$$array;a&&a.splice(a.indexOf(c),1),k.$broadcast(u+"-destroyed",c)},function(){c.$pending=!1}),a},c.$diff=function(){return DeepDiff.deep(old,c,function(a,b){return"$"===b[0]})},c.$commit=function(){return g.push(a.toJson(c)),c},c.$rollback=function(a){var b=g[a||g.length-1];return c.$update(JSON.parse(b)),c},c.$update=function(a){return j(a,c),c},c.$copy=function(){var b=a.toJson(this);return new r(a.fromJson(b))},c.$commit()}var s={},t=n.split("/"),u=t[t.length-1];p=i({},f(c.defaultOptions),p);var v=function(a,b){var c=a.constructor===r?a:new r(a);return c.$$array=b,c},w=function(a){var b=a.toString();return b=b.substr("function ".length),b=b.substr(0,b.indexOf("("))};return r.$cache=o(n),d(p.actions,function(a,b){"base"!==b&&"$"!==b[0]&&(r[b]=function(){var c=Array.prototype.slice.call(arguments);return r.$buildRequest.apply(this,[b,a].concat(c))})}),r.$buildRequest=function(b,c,d,g){var h=f(p.actions.base);e(h,f(c)),h.cache===!0&&(h.cache=r.$cache),h.method=h.method||"GET";var j=p.prefix?p.prefix+"/":"";if(h.override)j=h.url;else if(j+=n,h.url&&(j+="/"+h.url),j=r.$url(j,d,h.method),("get"===b||"post"===b||"update"===b||"delete"===b)&&(j+="/{"+p.pk+"}"),"GET"===h.method&&(a.isString(d)||a.isNumber(d))){var k={};k[p.pk]=d,d=k,g&&(h.params=i({},h.params,g))}else"GET"===h.method&&a.isObject(d)&&(h.params=i({},h.params,d));return h.url=r.$url(j,d,h.method),"delete"!==b&&"DELETE"!==h.method&&(h.data=d),r.$call(h)},r.$call=function(a){var b=a.method+":"+a.url;if(s[b])return s[b];var c=m.defer();return s[b]=c.promise,a.data=f(a.data),a.beforeRequest&&a.beforeRequest(a),a.data=r.$strip(a.data),l(a).then(function(b){if(a.afterRequest){var d=a.afterRequest(b.data);d&&(b.data=d)}a.invalidateCache&&r.$cache.removeAll(),b?a.wrap?a.isArray?c.resolve(new r.List(b.data)):c.resolve(new r(b.data)):c.resolve(b.data):c.resolve()},c.reject)["finally"](function(){s[b]=void 0}),c.promise},r.$url=function(a,c,d){var e=new b(a||n).fill(function(a){var b=c[a];return b?("GET"===d&&delete c[a],b):null});return p.stripTrailingSlashes&&(e=e.replace(/\/+$/,"")||"/"),e},r.$strip=function(a){return a&&"object"==typeof a&&d(a,function(b,c){g.indexOf(c)>-1&&delete a[c]}),a},d(p,function(a,b){-1===h.indexOf(b)&&(r[b]=a)}),r.List=q,r}return p}]}),c});